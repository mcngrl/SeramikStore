// <auto-generated>
// This file is generated. Do not edit manually.
// Generated at      : 2026-01-24 22:23:17
// Generated at (UTC): 2026-01-24 19:23:17
// Machine: DESKTOP-IITN2G2
// Generator: EntityCreator v1.0
// Class Name: ServiceWriter
// </auto-generated>

#nullable enable

#nullable enable
using System;
using System.Data;
using Microsoft.Data.SqlClient;
using System.Collections.Generic;
using Microsoft.Extensions.Configuration;
using SeramikStore.Contracts.Potansiyel;
using SeramikStore.Contracts.Common;

namespace SeramikStore.Services
{
    public partial class PotansiyelService : IPotansiyelService
    {
        private readonly string _connectionString;

        public PotansiyelService(IConfiguration configuration)
        {
            _connectionString = configuration.GetConnectionString("DefaultConnection");
        }

        public int Create(PotansiyelCreateDto dto)
        {
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_Insert", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Name", (object?)dto.Name ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@SurName", (object?)dto.SurName ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@KnownName", (object?)dto.KnownName ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@Email", (object?)dto.Email ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@PhoneNumber", (object?)dto.PhoneNumber ?? DBNull.Value);
            conn.Open();
            return Convert.ToInt32(cmd.ExecuteScalar());
        }
        

        public void Update(PotansiyelUpdateDto dto)
        {
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_Update", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Id", dto.Id);
            cmd.Parameters.AddWithValue("@Name", (object?)dto.Name ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@SurName", (object?)dto.SurName ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@KnownName", (object?)dto.KnownName ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@Email", (object?)dto.Email ?? DBNull.Value);
            cmd.Parameters.AddWithValue("@PhoneNumber", (object?)dto.PhoneNumber ?? DBNull.Value);
            conn.Open();
            cmd.ExecuteNonQuery();
        }
        

        public void Delete(int id)
        {
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_Delete", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Id", id);
            conn.Open();
            cmd.ExecuteNonQuery();
        }

        public void DeleteSoft(int id)
        {
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_DeleteSoft", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Id", id);
            conn.Open();
            cmd.ExecuteNonQuery();
        }

        public PotansiyelDto? GetById(int id)
        {
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_GetById", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Id", id);
            conn.Open();
            using var rdr = cmd.ExecuteReader();
            if (!rdr.Read()) return null;
        
            return new PotansiyelDto
            {
                Id = (int)rdr["Id"],
                Name = rdr["Name"] == DBNull.Value ? (string?)null : (string)rdr["Name"],
                SurName = rdr["SurName"] == DBNull.Value ? (string?)null : (string)rdr["SurName"],
                KnownName = rdr["KnownName"] == DBNull.Value ? (string?)null : (string)rdr["KnownName"],
                Email = rdr["Email"] == DBNull.Value ? (string?)null : (string)rdr["Email"],
                PhoneNumber = rdr["PhoneNumber"] == DBNull.Value ? (string?)null : (string)rdr["PhoneNumber"],
                IsActive = (bool)rdr["IsActive"],
            };
        }
        

        public List<PotansiyelListItemDto> List()
        {
            var list = new List<PotansiyelListItemDto>();
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_List", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            conn.Open();
            using var rdr = cmd.ExecuteReader();
            while (rdr.Read())
            {
                list.Add(new PotansiyelListItemDto
                {
                    Id = (int)rdr["Id"],
                    Name = rdr["Name"] == DBNull.Value ? (string?)null : (string)rdr["Name"],
                    SurName = rdr["SurName"] == DBNull.Value ? (string?)null : (string)rdr["SurName"],
                    KnownName = rdr["KnownName"] == DBNull.Value ? (string?)null : (string)rdr["KnownName"],
                    Email = rdr["Email"] == DBNull.Value ? (string?)null : (string)rdr["Email"],
                    PhoneNumber = rdr["PhoneNumber"] == DBNull.Value ? (string?)null : (string)rdr["PhoneNumber"],
                    IsActive = (bool)rdr["IsActive"],
                });
            }
            return list;
        }
        

        public PagedResult<PotansiyelListItemDto> PagedList(int page, int pageSize)
        {
            var result = new PagedResult<PotansiyelListItemDto>();
            using var conn = new SqlConnection(_connectionString);
            using var cmd = new SqlCommand("sp_Potansiyel_PagedList", conn);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue("@Page", page);
            cmd.Parameters.AddWithValue("@PageSize", pageSize);
            conn.Open();
            using var rdr = cmd.ExecuteReader();
            while (rdr.Read())
            {
                result.Items.Add(new PotansiyelListItemDto
                {
                    Id = (int)rdr["Id"],
                    Name = rdr["Name"] == DBNull.Value ? (string?)null : (string)rdr["Name"],
                    SurName = rdr["SurName"] == DBNull.Value ? (string?)null : (string)rdr["SurName"],
                    KnownName = rdr["KnownName"] == DBNull.Value ? (string?)null : (string)rdr["KnownName"],
                    Email = rdr["Email"] == DBNull.Value ? (string?)null : (string)rdr["Email"],
                    PhoneNumber = rdr["PhoneNumber"] == DBNull.Value ? (string?)null : (string)rdr["PhoneNumber"],
                    IsActive = (bool)rdr["IsActive"],
                });
            }
        
            if (rdr.NextResult() && rdr.Read())
                result.TotalCount = (int)rdr["TotalCount"];
        
            return result;
        }
        
    }
}
